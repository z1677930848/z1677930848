<!DOCTYPE html>
<html lang="zh">
<head>
    <title>{$.teaTitle}</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
    {$if eq .teaFaviconFileId 0}
    <link rel="shortcut icon" href="/images/favicon.png"/>
    {$else}
    <link rel="shortcut icon" href="/ui/image/{$.teaFaviconFileId}"/>
    {$end}

    {$TEA.SEMANTIC}
    {$TEA.VUE}
    {$echo "header"}

    <link rel="stylesheet" type="text/css" href="/css/unified-ui.css?v={$ .teaVersion}"/>
    <link rel="stylesheet" type="text/css" href="/_/@user/@layout.css?v={$ .teaVersion}"/>

    <script type="text/javascript" src="/js/components.js"></script>
    <script type="text/javascript" src="/js/utils.js"></script>
    <script type="text/javascript" src="/js/sweetalert2/dist/sweetalert2.all.min.js"></script>
</head>
<body class="app-shell">

<!-- 顶部导航 -->
<div class="ui menu top-nav blue inverted small borderless app-topbar" v-cloak="">
    <a href="/user/dashboard" class="item brand">
        <i class="rocket icon"></i>
        <div class="content">
            {$.teaTitle}
            <div class="sub header">用户控制台</div>
        </div>
    </a>

    <a href="" class="item mobile-only" @click.prevent="toggleMobileSidebar">
        <i class="bars icon"></i>
    </a>

    <div class="right menu">
        <a href="/user/stats" class="item desktop-only">
            <i class="chart bar icon"></i> 数据概览
        </a>
        <a href="/user/profile" class="item desktop-only">
            <i class="cog icon"></i> 个人设置
        </a>
        <div class="ui dropdown item">
            <i class="user circle icon"></i> {$.teaUsername}
            <i class="dropdown icon"></i>
            <div class="menu">
                <a href="/user/profile" class="item">
                    <i class="cog icon"></i> 账户资料
                </a>
                <div class="divider"></div>
                <a href="/user/logout" class="item">
                    <i class="sign out icon"></i> 退出登录
                </a>
            </div>
        </div>
    </div>
</div>

<div class="app-layout">
    <!-- 侧边栏 -->
    <div class="app-sidebar user-sidebar" :class="{ 'is-collapsed': !sidebarOpen, 'is-mobile-open': mobileSidebarOpen }" v-cloak="">
        <div class="ui vertical inverted menu fluid">
            <a v-for="item in menuItems" :key="item.code" :href="item.url" class="item" :class="{ 'active': teaMenu == item.code }">
                <i :class="item.icon + ' icon'"></i>
                <div class="menu-text">{{item.name}}</div>
                <div class="subtitle" v-if="item.desc">{{item.desc}}</div>
            </a>
        </div>
    </div>

    <!-- 主内容区 -->
    <div class="app-main user-main" :class="{ 'is-collapsed': !sidebarOpen }" v-cloak="">
        <div class="ui secondary pointing menu stackable app-toolbar">
            <a href="" class="item" @click.prevent="toggleSidebar">
                <i :class="sidebarOpen ? 'angle double left icon' : 'angle double right icon'"></i>
                <span>侧边栏</span>
            </a>
            <div class="right menu">
                <a href="/user/profile" class="item"><i class="cog icon"></i> 个人设置</a>
                <a href="/user/logout" class="item"><i class="sign out icon"></i> 退出登录</a>
            </div>
        </div>

        <div class="ui segment app-panel">
            {$TEA.VIEW}
        </div>
    </div>
</div>

<!-- 移动端遮罩 -->
<div class="app-mask" v-show="mobileSidebarOpen" @click="closeMobileSidebar"></div>

{$echo "footer"}

<script>
Tea.context(function () {
    this.sidebarOpen = window.innerWidth > 1024
    this.mobileSidebarOpen = false
    this.teaMenu = "{$.teaMenu}"
    this.teaTitle = "{$.teaTitle}"
    this.teaUsername = "{$.teaUsername}"
    this.menuItems = [
        {code: "dashboard", name: "仪表盘", icon: "home", url: "/user/dashboard"},
        {code: "domains", name: "域名管理", icon: "globe", url: "/user/domains"},
        {code: "stats", name: "统计报表", icon: "chart bar", url: "/user/stats"},
        {code: "ssl", name: "证书管理", icon: "shield alternate", url: "/user/ssl"},
        {code: "billing", name: "计费中心", icon: "credit card outline", url: "/user/billing"},
        {code: "profile", name: "个人设置", icon: "user", url: "/user/profile"}
    ]

    this.toggleSidebar = function () {
        this.sidebarOpen = !this.sidebarOpen
        this.mobileSidebarOpen = false
    }
    this.toggleMobileSidebar = function () {
        this.mobileSidebarOpen = !this.mobileSidebarOpen
        this.sidebarOpen = true
    }
    this.closeMobileSidebar = function () {
        this.mobileSidebarOpen = false
    }

    this.$delay(function () {
        $('.ui.dropdown').dropdown({
            action: 'hide'
        })
    })

    window.addEventListener("resize", () => {
        this.sidebarOpen = window.innerWidth > 1024
        this.mobileSidebarOpen = false
    })
})
</script>

</body>
</html>
